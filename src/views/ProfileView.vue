<template>
  <div class="container mx-auto max-w-6xl p-4">
    <!-- ç”¨æˆ·ä¿¡æ¯å’Œé‚€è¯·æ´»åŠ¨å¡ç‰‡åŒºåŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <!-- ç”¨æˆ·ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
      <div class="card bg-base-300">
        <div class="card-body">
          <!-- å¤´éƒ¨ï¼šå¤´åƒã€ç”¨æˆ·åã€ç­‰çº§ã€æ“ä½œæŒ‰é’® -->
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-4">
              <div class="avatar">
                <div class="w-16 rounded-full bg-primary">
                  <div class="flex items-center justify-center h-full">
                    <span class="text-primary-content text-2xl">ğŸ±</span>
                  </div>
                </div>
              </div>
              <div>
                <div class="flex items-center gap-2 mb-1">
                  <h2 class="text-xl font-bold">{{ userProfile.username }}</h2>
                  <div class="badge badge-neutral">Lv{{ userProfile.level }}</div>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-sm opacity-60">ID:{{ userProfile.userId }}</span>
                  <button class="btn btn-ghost btn-xs" @click="copyUserId">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="flex gap-2">
              <button class="btn btn-ghost btn-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                è®¾ç½®
              </button>
              <button class="btn btn-ghost btn-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                ç¼–è¾‘
              </button>
            </div>
          </div>

          <!-- ç»Ÿè®¡æ•°æ® -->
          <div class="grid grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold">{{ userProfile.stats.followers }}</div>
              <div class="text-sm opacity-60">ç²‰ä¸</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold">{{ userProfile.stats.interactions }}</div>
              <div class="text-sm opacity-60">äº’åŠ¨</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold">{{ userProfile.stats.characters }}</div>
              <div class="text-sm opacity-60">è§’è‰²</div>
            </div>
          </div>
        </div>
      </div>

      <!-- é‚€è¯·æ´»åŠ¨å¡ç‰‡ -->
      <div class="card bg-base-300">
        <div class="card-body">
        <!-- é‚€è¯·æ´»åŠ¨æ ‡é¢˜ -->
        <div class="flex items-center gap-3 mb-4">
          <div class="avatar">
            <div class="w-12 rounded-full bg-secondary">
              <div class="flex items-center justify-center h-full">
                <span class="text-secondary-content text-lg">ğŸ‘¥</span>
              </div>
            </div>
          </div>
          <div>
            <h3 class="card-title text-lg">é‚€è¯·æ´»åŠ¨</h3>
            <div class="flex items-center gap-2">
              <div class="badge badge-accent">+50</div>
            </div>
          </div>
        </div>

        <!-- æ´»åŠ¨æè¿° -->
        <p class="text-sm opacity-70 mb-4">
          é‚€è¯·ä½ çš„æœ‹å‹æ¥Mufyï¼å¤§å®¶éƒ½å¯ä»¥è·å¾—é¢å¤–çš„50ä»£å¸ï¼
        </p>

        <!-- é‚€è¯·è¿›åº¦ -->
        <div class="flex items-center justify-center gap-2 mb-4">
          <div class="badge badge-outline">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
            {{ inviteData.invited }}/{{ inviteData.total }}
          </div>
          <span class="text-sm opacity-60">å·²é‚€è¯·</span>
        </div>

        <!-- é‚€è¯·ç  -->
        <div class="card-actions justify-center">
          <div class="join">
            <input
              type="text"
              :value="inviteData.code"
              readonly
              class="input input-bordered join-item w-32 text-center font-mono"
            />
            <button
              class="btn btn-primary join-item"
              @click="copyInviteCode"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- æ¯æ—¥ç­¾åˆ°å¡ç‰‡ -->
    <div class="card bg-base-300 max-w-2xl mx-auto mt-6">
      <div class="card-body">
        <!-- ç­¾åˆ°æ ‡é¢˜ -->
        <div class="text-center mb-4">
          <h3 class="card-title text-xl justify-center mb-2">å·²è¿ç»­ç­¾åˆ° {{ checkinData.consecutiveDays }} å¤©</h3>
          <p class="text-sm opacity-70">æ¯å¤©ç™»å½•è‡ªåŠ¨ä¸ºæ‚¨ç­¾åˆ°ï¼Œè®°å¾—æ¯å¤©éƒ½æ¥é¢†ç§¯åˆ†å“¦~</p>
        </div>

        <!-- ç­¾åˆ°æ—¥å† -->
        <div class="grid grid-cols-7 gap-2 sm:gap-3">
          <div
            v-for="(day, index) in checkinData.days"
            :key="index"
            class="flex flex-col items-center"
          >
            <!-- ç­¾åˆ°çŠ¶æ€å’Œå¥–åŠ± -->
            <div
              :class="[
                'flex flex-col items-center justify-center w-16 h-20 sm:w-20 sm:h-24 rounded-2xl transition-all duration-200',
                day.status === 'completed' ? 'bg-primary text-primary-content' :
                day.status === 'current' ? 'bg-primary text-primary-content ring-2 ring-primary ring-offset-2' :
                'bg-base-200 text-base-content hover:bg-base-300'
              ]"
              @click="handleCheckin(day)"
            >
              <!-- å¥–åŠ±ç§¯åˆ† -->
              <div class="text-sm font-bold mb-1">+{{ day.reward }}</div>

              <!-- çŠ¶æ€å›¾æ ‡ -->
              <div class="text-lg">
                <svg v-if="day.status === 'completed'" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                <span v-else-if="day.status === 'current'" class="text-2xl">ğŸ</span>
                <span v-else class="text-2xl">ğŸ</span>
              </div>
            </div>

            <!-- æ—¥æœŸæ ‡ç­¾ -->
            <div class="text-xs opacity-60 mt-2">{{ day.label }}</div>
          </div>
        </div>

        <!-- ç­¾åˆ°æŒ‰é’® -->
        <div class="card-actions justify-center mt-6" v-if="canCheckinToday">
          <button
            class="btn btn-primary btn-wide"
            @click="performCheckin"
            :disabled="isCheckinProcessing"
          >
            <span v-if="isCheckinProcessing" class="loading loading-spinner loading-sm"></span>
            {{ isCheckinProcessing ? 'ç­¾åˆ°ä¸­...' : 'ç«‹å³ç­¾åˆ°' }}
          </button>
        </div>
      </div>
    </div>

    <!-- è®°å½•åˆ—è¡¨ -->
    <div class="card bg-base-300 max-w-4xl mx-auto mt-6">
      <div class="card-body">
        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tabs tabs-bordered mb-6">
          <button
            v-for="tab in recordTabs"
            :key="tab.key"
            :class="{ 'tab-active': activeRecordTab === tab.key }"
            class="tab tab-lg"
            @click="activeRecordTab = tab.key"
          >
            {{ tab.label }}
          </button>
        </div>

        <!-- è®°å½•åˆ—è¡¨ -->
        <div class="space-y-3 sm:space-y-4">
          <div
            v-for="record in currentRecords"
            :key="record.id"
            class="flex items-center justify-between p-3 sm:p-4 bg-base-100 rounded-lg hover:bg-base-200 transition-colors"
          >
            <!-- å·¦ä¾§ä¿¡æ¯ -->
            <div class="flex items-center gap-2 sm:gap-3 min-w-0 flex-1">
              <!-- å›¾æ ‡ -->
              <div class="avatar flex-shrink-0">
                <div class="w-8 sm:w-10 rounded-lg bg-secondary">
                  <div class="flex items-center justify-center h-full">
                    <span class="text-secondary-content text-xs sm:text-sm">{{ record.icon }}</span>
                  </div>
                </div>
              </div>

              <!-- è®°å½•ä¿¡æ¯ -->
              <div class="min-w-0 flex-1">
                <h4 class="font-medium text-sm sm:text-base text-base-content truncate">{{ record.title }}</h4>
                <p class="text-xs sm:text-sm opacity-60 truncate">{{ record.timestamp }}</p>
              </div>
            </div>

            <!-- å³ä¾§ä¿¡æ¯ -->
            <div class="text-right flex-shrink-0 ml-2">
              <div class="text-xs sm:text-sm opacity-60 mb-1 truncate max-w-[120px] sm:max-w-none">{{ record.description }}</div>
              <div
                :class="[
                  'font-bold text-base sm:text-lg',
                  record.amount > 0 ? 'text-success' : 'text-error'
                ]"
              >
                {{ record.amount > 0 ? '+' : '' }}{{ record.amount }}
              </div>
            </div>
          </div>
        </div>

        <!-- åˆ†é¡µ -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4 mt-6" v-if="pagination.totalPages > 1">
          <div class="btn-group">
            <button
              class="btn btn-xs sm:btn-sm"
              :disabled="pagination.currentPage === 1"
              @click="changePage(pagination.currentPage - 1)"
            >
              Â«
            </button>

            <button
              v-for="page in visiblePages"
              :key="page"
              :class="[
                'btn btn-xs sm:btn-sm',
                pagination.currentPage === page ? 'btn-active' : ''
              ]"
              @click="changePage(page)"
            >
              {{ page }}
            </button>

            <button
              class="btn btn-xs sm:btn-sm"
              :disabled="pagination.currentPage === pagination.totalPages"
              @click="changePage(pagination.currentPage + 1)"
            >
              Â»
            </button>
          </div>

          <span class="text-xs sm:text-sm opacity-60 mt-2 sm:mt-0">
            ç¬¬ {{ pagination.currentPage }} é¡µï¼Œå…± {{ pagination.totalPages }} é¡µ
          </span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

// ç”¨æˆ·ä¸ªäººä¿¡æ¯
const userProfile = ref({
  username: 'mufyer',
  level: 0,
  userId: '439372',
  avatar: 'ğŸ±',
  stats: {
    followers: 0,
    interactions: 0,
    characters: 0
  }
})

// é‚€è¯·æ´»åŠ¨æ•°æ®
const inviteData = ref({
  code: 'TNq5vc4X',
  invited: 0,
  total: 10
})

// ç­¾åˆ°æ•°æ®
const checkinData = ref({
  consecutiveDays: 2,
  days: [
    { label: 'ç¬¬1å¤©', reward: 30, status: 'completed' },
    { label: 'ä»Šå¤©', reward: 35, status: 'current' },
    { label: 'ç¬¬3å¤©', reward: 40, status: 'pending' },
    { label: 'ç¬¬4å¤©', reward: 45, status: 'pending' },
    { label: 'ç¬¬5å¤©', reward: 50, status: 'pending' },
    { label: 'ç¬¬6å¤©', reward: 50, status: 'pending' },
    { label: 'ç¬¬7å¤©', reward: 50, status: 'pending' }
  ]
})

// ç­¾åˆ°çŠ¶æ€
const isCheckinProcessing = ref(false)
const canCheckinToday = ref(true)

// è®°å½•æ ‡ç­¾é¡µ
const recordTabs = [
  { key: 'coins', label: 'è´§å¸æ¶ˆè€—' },
  { key: 'recharge', label: 'å……å€¼è®°å½•' },
  { key: 'creation', label: 'åˆ›ä½œç­‰çº§' }
]

// å½“å‰é€‰ä¸­çš„è®°å½•æ ‡ç­¾
const activeRecordTab = ref('coins')

// æ¨¡æ‹Ÿè®°å½•æ•°æ®
const allRecords = {
  coins: [
    {
      id: 1,
      icon: 'ğŸ',
      title: 'å…è´¹çŒ«ç²®',
      timestamp: '2025-09-27 14:37:46',
      description: 'æ¯æ—¥ç­¾åˆ°å¥–åŠ±',
      amount: 30
    },
    {
      id: 2,
      icon: 'ğŸ',
      title: 'å…è´¹çŒ«ç²®',
      timestamp: '2025-09-25 00:00:51',
      description: 'æ¯æ—¥ç­¾åˆ°å¥–åŠ±',
      amount: 30
    },
    {
      id: 3,
      icon: 'ğŸ',
      title: 'å…è´¹çŒ«ç²®',
      timestamp: '2025-09-13 23:02:58',
      description: 'ç¥ç§˜åŒå­åº§ è®°å¿†åŠ è½½',
      amount: -3
    },
    {
      id: 4,
      icon: 'ğŸ',
      title: 'å…è´¹çŒ«ç²®',
      timestamp: '2025-09-13 20:01:22',
      description: 'ç¥ç§˜åŒå­åº§ è®°å¿†åŠ è½½',
      amount: -3
    },
    {
      id: 5,
      icon: 'ğŸ',
      title: 'å…è´¹çŒ«ç²®',
      timestamp: '2025-09-13 19:58:57',
      description: 'éä¸­æ–­ç»­å†™æ‰£è´¹',
      amount: -1
    }
  ],
  recharge: [
    {
      id: 6,
      icon: 'ğŸ’³',
      title: 'å……å€¼è®°å½•',
      timestamp: '2025-09-20 10:30:00',
      description: 'æ”¯ä»˜å®å……å€¼',
      amount: 100
    }
  ],
  creation: [
    {
      id: 7,
      icon: 'â­',
      title: 'åˆ›ä½œç­‰çº§',
      timestamp: '2025-09-15 16:45:30',
      description: 'è§’è‰²åˆ›ä½œå¥–åŠ±',
      amount: 50
    }
  ]
}

// åˆ†é¡µé…ç½®
const pagination = ref({
  currentPage: 1,
  pageSize: 5,
  totalPages: 2
})

// å¤åˆ¶ç”¨æˆ·ID
const copyUserId = async () => {
  try {
    await navigator.clipboard.writeText(userProfile.value.userId)
    console.log('ç”¨æˆ·IDå·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
    // è¿™é‡Œå¯ä»¥æ·»åŠ æˆåŠŸæç¤º
  } catch (err) {
    console.error('å¤åˆ¶å¤±è´¥:', err)
  }
}

// å¤åˆ¶é‚€è¯·ç 
const copyInviteCode = async () => {
  try {
    await navigator.clipboard.writeText(inviteData.value.code)
    console.log('é‚€è¯·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
    // è¿™é‡Œå¯ä»¥æ·»åŠ æˆåŠŸæç¤º
  } catch (err) {
    console.error('å¤åˆ¶å¤±è´¥:', err)
  }
}

// å¤„ç†ç­¾åˆ°ç‚¹å‡»
const handleCheckin = (day) => {
  if (day.status === 'current') {
    performCheckin()
  }
}

// æ‰§è¡Œç­¾åˆ°
const performCheckin = async () => {
  if (isCheckinProcessing.value) return

  isCheckinProcessing.value = true

  try {
    // æ¨¡æ‹Ÿç­¾åˆ°è¯·æ±‚
    await new Promise(resolve => setTimeout(resolve, 1500))

    // æ›´æ–°ç­¾åˆ°çŠ¶æ€
    const currentDayIndex = checkinData.value.days.findIndex(day => day.status === 'current')
    if (currentDayIndex !== -1) {
      checkinData.value.days[currentDayIndex].status = 'completed'

      // å¦‚æœä¸æ˜¯æœ€åä¸€å¤©ï¼Œè®¾ç½®ä¸‹ä¸€å¤©ä¸ºå½“å‰
      if (currentDayIndex < checkinData.value.days.length - 1) {
        checkinData.value.days[currentDayIndex + 1].status = 'current'
        checkinData.value.consecutiveDays++
      } else {
        // å¦‚æœæ˜¯æœ€åä¸€å¤©ï¼Œé‡ç½®å‘¨æœŸ
        canCheckinToday.value = false
      }
    }

    console.log('ç­¾åˆ°æˆåŠŸ!')
    // è¿™é‡Œå¯ä»¥æ·»åŠ æˆåŠŸæç¤º

  } catch (err) {
    console.error('ç­¾åˆ°å¤±è´¥:', err)
  } finally {
    isCheckinProcessing.value = false
  }
}

// è®¡ç®—å½“å‰æ˜¾ç¤ºçš„è®°å½•
const currentRecords = computed(() => {
  const records = allRecords[activeRecordTab.value] || []
  const start = (pagination.value.currentPage - 1) * pagination.value.pageSize
  const end = start + pagination.value.pageSize
  return records.slice(start, end)
})

// è®¡ç®—å¯è§çš„é¡µç 
const visiblePages = computed(() => {
  const { currentPage, totalPages } = pagination.value
  const pages = []

  // æ˜¾ç¤ºå½“å‰é¡µå’Œå‰åå„ä¸€é¡µ
  const start = Math.max(1, currentPage - 1)
  const end = Math.min(totalPages, currentPage + 1)

  for (let i = start; i <= end; i++) {
    pages.push(i)
  }

  return pages
})

// åˆ‡æ¢é¡µç 
const changePage = (page) => {
  if (page >= 1 && page <= pagination.value.totalPages) {
    pagination.value.currentPage = page
  }
}
</script>